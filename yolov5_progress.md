# Explain the progress and result of yolov5

- **注明：这是跟着b导学习的yolov5，源码来源于b导的github** https://github.com/bubbliiiing/yolov5-pytorch



## 数据集

数据集，我直接使用原主的voc数据集，且已经写好数据集预处理。

```python

D:\softwear_dl\anaconda\envs\torch1.10\python.exe D:/shuqikaohe/yolov5-pytorch-main/voc_annotation.py
Generate txt in ImageSets.
train and val size 19352
train size 17416
Generate txt in ImageSets done.
Generate 2007_train.txt and 2007_val.txt for train.
Generate 2007_train.txt and 2007_val.txt for train done.
|   aeroplane |  1336 | 
|     bicycle |  1259 | 
|        bird |  1900 | 
|        boat |  1294 | 
|      bottle |  2013 | 
|         bus |   911 | 
|         car |  4025 | 
|         cat |  1768 | 
|       chair |  3497 | 
|         cow |  1012 | 
| diningtable |   922 | 
|         dog |  2222 | 
|       horse |  1287 | 
|   motorbike |  1248 | 
|      person | 16051 | 
| pottedplant |  1784 | 
|       sheep |  1129 | 
|        sofa |   951 | 
|       train |  1086 | 
|   tvmonitor |  1283 | 


```





（7月4日）

首先，我们先总网络结构开始。

CSPdarknet 跟yolov3的darknet53网络架构有的很带的改动，不再是简单的残差堆叠，把一个大的残差块，分成四部分，每一部分有一个conv和再次conv后的block堆叠，中间的残差块比较深，两边的较浅，在感受野最大的特征图之前还增加了spp由三个不同的kennel形成的最大池化，相比yolov3，特征提取深度更深。最重要的是是它能够在增加深度的同时，能够保持广度，而且还减少了网络层数，也就意味着减少了参数，使得网络更加轻量化。

然后到yolo_body部分，yolo_body部分增加了csplayer和倒三角的操作，特区到的特征更加充分，同时也增加了网络的复杂度，检测的效果更好。

网络结构如下所示![](.\picture\8.png)

<<<<<<< HEAD

=======
[[![img](.\picture\8.png)](/picture\8.png)](https://github.com/yuanxiao7/summer_project/commit/3cfd44dccc2e92a4887bd738cc83b5a2564d9202)

>>>>>>> f719d01d29830a4f005ad0a171c05bf5b8bffde0

（7月5日）

yolo解码

**借鉴出处** https://blog.csdn.net/weixin_45377629/article/details/124144913

再利用darknet和yolobody后得到3个yolo_head的输出，不同尺度之下，每个网格点均有先验框，网络训练过程会对先验框的参数进行调整，进而得到预测框，从不同尺度下预测框还原到原图输入的图像上，同时包括该框内目标预测的结果情况（预测框的位置、类别概率、置信度分数）
<<<<<<< HEAD



## 配置参数

整个网络的执行循序如下：


----------------------------------------------------------------

        Layer (type)               Output Shape         Param #
          
    ​        ================================================================
    ​                Conv2d-1         [-1, 64, 320, 320]           6,912
    ​           BatchNorm2d-2         [-1, 64, 320, 320]             128
    ​                  SiLU-3         [-1, 64, 320, 320]               0
    ​                  Conv-4         [-1, 64, 320, 320]               0
    ​                 Focus-5         [-1, 64, 320, 320]               0
    ​                Conv2d-6        [-1, 128, 160, 160]          73,728
    ​           BatchNorm2d-7        [-1, 128, 160, 160]             256
    ​                  SiLU-8        [-1, 128, 160, 160]               0
    ​                  Conv-9        [-1, 128, 160, 160]               0
    ​               Conv2d-10         [-1, 64, 160, 160]           8,192
    ​          BatchNorm2d-11         [-1, 64, 160, 160]             128
    ​                 SiLU-12         [-1, 64, 160, 160]               0
    ​                 Conv-13         [-1, 64, 160, 160]               0
    ​               Conv2d-14         [-1, 64, 160, 160]           4,096
    ​          BatchNorm2d-15         [-1, 64, 160, 160]             128
    ​                 SiLU-16         [-1, 64, 160, 160]               0
    ​                 Conv-17         [-1, 64, 160, 160]               0
    ​               Conv2d-18         [-1, 64, 160, 160]          36,864
    ​          BatchNorm2d-19         [-1, 64, 160, 160]             128
    ​                 SiLU-20         [-1, 64, 160, 160]               0
    ​                 Conv-21         [-1, 64, 160, 160]               0
    ​           Bottleneck-22         [-1, 64, 160, 160]               0
    ​               Conv2d-23         [-1, 64, 160, 160]           4,096
    ​          BatchNorm2d-24         [-1, 64, 160, 160]             128
    ​                 SiLU-25         [-1, 64, 160, 160]               0
    ​                 Conv-26         [-1, 64, 160, 160]               0
    ​               Conv2d-27         [-1, 64, 160, 160]          36,864
    ​          BatchNorm2d-28         [-1, 64, 160, 160]             128
    ​                 SiLU-29         [-1, 64, 160, 160]               0
    ​                 Conv-30         [-1, 64, 160, 160]               0
    ​           Bottleneck-31         [-1, 64, 160, 160]               0
    ​               Conv2d-32         [-1, 64, 160, 160]           4,096
    ​          BatchNorm2d-33         [-1, 64, 160, 160]             128
    ​                 SiLU-34         [-1, 64, 160, 160]               0
    ​                 Conv-35         [-1, 64, 160, 160]               0
    ​               Conv2d-36         [-1, 64, 160, 160]          36,864
    ​          BatchNorm2d-37         [-1, 64, 160, 160]             128
    ​                 SiLU-38         [-1, 64, 160, 160]               0
    ​                 Conv-39         [-1, 64, 160, 160]               0
    ​           Bottleneck-40         [-1, 64, 160, 160]               0
    ​               Conv2d-41         [-1, 64, 160, 160]           8,192
    ​          BatchNorm2d-42         [-1, 64, 160, 160]             128
    ​                 SiLU-43         [-1, 64, 160, 160]               0
    ​                 Conv-44         [-1, 64, 160, 160]               0
    ​               Conv2d-45        [-1, 128, 160, 160]          16,384
    ​          BatchNorm2d-46        [-1, 128, 160, 160]             256
    ​                 SiLU-47        [-1, 128, 160, 160]               0
    ​                 Conv-48        [-1, 128, 160, 160]               0
    ​                   C3-49        [-1, 128, 160, 160]               0
    ​               Conv2d-50          [-1, 256, 80, 80]         294,912
    ​          BatchNorm2d-51          [-1, 256, 80, 80]             512
    ​                 SiLU-52          [-1, 256, 80, 80]               0
    ​                 Conv-53          [-1, 256, 80, 80]               0
    ​               Conv2d-54          [-1, 128, 80, 80]          32,768
    ​          BatchNorm2d-55          [-1, 128, 80, 80]             256
    ​                 SiLU-56          [-1, 128, 80, 80]               0
    ​                 Conv-57          [-1, 128, 80, 80]               0
    ​               Conv2d-58          [-1, 128, 80, 80]          16,384
    ​          BatchNorm2d-59          [-1, 128, 80, 80]             256
    ​                 SiLU-60          [-1, 128, 80, 80]               0
    ​                 Conv-61          [-1, 128, 80, 80]               0
    ​               Conv2d-62          [-1, 128, 80, 80]         147,456
    ​          BatchNorm2d-63          [-1, 128, 80, 80]             256
    ​                 SiLU-64          [-1, 128, 80, 80]               0
    ​                 Conv-65          [-1, 128, 80, 80]               0
    ​           Bottleneck-66          [-1, 128, 80, 80]               0
    ​               Conv2d-67          [-1, 128, 80, 80]          16,384
    ​          BatchNorm2d-68          [-1, 128, 80, 80]             256
    ​                 SiLU-69          [-1, 128, 80, 80]               0
    ​                 Conv-70          [-1, 128, 80, 80]               0
    ​               Conv2d-71          [-1, 128, 80, 80]         147,456
    ​          BatchNorm2d-72          [-1, 128, 80, 80]             256
    ​                 SiLU-73          [-1, 128, 80, 80]               0
    ​                 Conv-74          [-1, 128, 80, 80]               0
    ​           Bottleneck-75          [-1, 128, 80, 80]               0
    ​               Conv2d-76          [-1, 128, 80, 80]          16,384
    ​          BatchNorm2d-77          [-1, 128, 80, 80]             256
    ​                 SiLU-78          [-1, 128, 80, 80]               0
    ​                 Conv-79          [-1, 128, 80, 80]               0
    ​               Conv2d-80          [-1, 128, 80, 80]         147,456
    ​          BatchNorm2d-81          [-1, 128, 80, 80]             256
    ​                 SiLU-82          [-1, 128, 80, 80]               0
    ​                 Conv-83          [-1, 128, 80, 80]               0
    ​           Bottleneck-84          [-1, 128, 80, 80]               0
    ​               Conv2d-85          [-1, 128, 80, 80]          16,384
    ​          BatchNorm2d-86          [-1, 128, 80, 80]             256
    ​                 SiLU-87          [-1, 128, 80, 80]               0
    ​                 Conv-88          [-1, 128, 80, 80]               0
    ​               Conv2d-89          [-1, 128, 80, 80]         147,456
    ​          BatchNorm2d-90          [-1, 128, 80, 80]             256
    ​                 SiLU-91          [-1, 128, 80, 80]               0
    ​                 Conv-92          [-1, 128, 80, 80]               0
    ​           Bottleneck-93          [-1, 128, 80, 80]               0
    ​               Conv2d-94          [-1, 128, 80, 80]          16,384
    ​          BatchNorm2d-95          [-1, 128, 80, 80]             256
    ​                 SiLU-96          [-1, 128, 80, 80]               0
    ​                 Conv-97          [-1, 128, 80, 80]               0
    ​               Conv2d-98          [-1, 128, 80, 80]         147,456
    ​          BatchNorm2d-99          [-1, 128, 80, 80]             256
    ​                SiLU-100          [-1, 128, 80, 80]               0
    ​                Conv-101          [-1, 128, 80, 80]               0
    ​          Bottleneck-102          [-1, 128, 80, 80]               0
    ​              Conv2d-103          [-1, 128, 80, 80]          16,384
    ​         BatchNorm2d-104          [-1, 128, 80, 80]             256
    ​                SiLU-105          [-1, 128, 80, 80]               0
    ​                Conv-106          [-1, 128, 80, 80]               0
    ​              Conv2d-107          [-1, 128, 80, 80]         147,456
    ​         BatchNorm2d-108          [-1, 128, 80, 80]             256
    ​                SiLU-109          [-1, 128, 80, 80]               0
    ​                Conv-110          [-1, 128, 80, 80]               0
    ​          Bottleneck-111          [-1, 128, 80, 80]               0
    ​              Conv2d-112          [-1, 128, 80, 80]          16,384
    ​         BatchNorm2d-113          [-1, 128, 80, 80]             256
    ​                SiLU-114          [-1, 128, 80, 80]               0
    ​                Conv-115          [-1, 128, 80, 80]               0
    ​              Conv2d-116          [-1, 128, 80, 80]         147,456
    ​         BatchNorm2d-117          [-1, 128, 80, 80]             256
    ​                SiLU-118          [-1, 128, 80, 80]               0
    ​                Conv-119          [-1, 128, 80, 80]               0
    ​          Bottleneck-120          [-1, 128, 80, 80]               0
    ​              Conv2d-121          [-1, 128, 80, 80]          16,384
    ​         BatchNorm2d-122          [-1, 128, 80, 80]             256
    ​                SiLU-123          [-1, 128, 80, 80]               0
    ​                Conv-124          [-1, 128, 80, 80]               0
    ​              Conv2d-125          [-1, 128, 80, 80]         147,456
    ​         BatchNorm2d-126          [-1, 128, 80, 80]             256
    ​                SiLU-127          [-1, 128, 80, 80]               0
    ​                Conv-128          [-1, 128, 80, 80]               0
    ​          Bottleneck-129          [-1, 128, 80, 80]               0
    ​              Conv2d-130          [-1, 128, 80, 80]          16,384
    ​         BatchNorm2d-131          [-1, 128, 80, 80]             256
    ​                SiLU-132          [-1, 128, 80, 80]               0
    ​                Conv-133          [-1, 128, 80, 80]               0
    ​              Conv2d-134          [-1, 128, 80, 80]         147,456
    ​         BatchNorm2d-135          [-1, 128, 80, 80]             256
    ​                SiLU-136          [-1, 128, 80, 80]               0
    ​                Conv-137          [-1, 128, 80, 80]               0
    ​          Bottleneck-138          [-1, 128, 80, 80]               0
    ​              Conv2d-139          [-1, 128, 80, 80]          32,768
    ​         BatchNorm2d-140          [-1, 128, 80, 80]             256
    ​                SiLU-141          [-1, 128, 80, 80]               0
    ​                Conv-142          [-1, 128, 80, 80]               0
    ​              Conv2d-143          [-1, 256, 80, 80]          65,536
    ​         BatchNorm2d-144          [-1, 256, 80, 80]             512
    ​                SiLU-145          [-1, 256, 80, 80]               0
    ​                Conv-146          [-1, 256, 80, 80]               0
    ​                  C3-147          [-1, 256, 80, 80]               0
    ​              Conv2d-148          [-1, 512, 40, 40]       1,179,648
    ​         BatchNorm2d-149          [-1, 512, 40, 40]           1,024
    ​                SiLU-150          [-1, 512, 40, 40]               0
    ​                Conv-151          [-1, 512, 40, 40]               0
    ​              Conv2d-152          [-1, 256, 40, 40]         131,072
    ​         BatchNorm2d-153          [-1, 256, 40, 40]             512
    ​                SiLU-154          [-1, 256, 40, 40]               0
    ​                Conv-155          [-1, 256, 40, 40]               0
    ​              Conv2d-156          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-157          [-1, 256, 40, 40]             512
    ​                SiLU-158          [-1, 256, 40, 40]               0
    ​                Conv-159          [-1, 256, 40, 40]               0
    ​              Conv2d-160          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-161          [-1, 256, 40, 40]             512
    ​                SiLU-162          [-1, 256, 40, 40]               0
    ​                Conv-163          [-1, 256, 40, 40]               0
    ​          Bottleneck-164          [-1, 256, 40, 40]               0
    ​              Conv2d-165          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-166          [-1, 256, 40, 40]             512
    ​                SiLU-167          [-1, 256, 40, 40]               0
    ​                Conv-168          [-1, 256, 40, 40]               0
    ​              Conv2d-169          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-170          [-1, 256, 40, 40]             512
    ​                SiLU-171          [-1, 256, 40, 40]               0
    ​                Conv-172          [-1, 256, 40, 40]               0
    ​          Bottleneck-173          [-1, 256, 40, 40]               0
    ​              Conv2d-174          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-175          [-1, 256, 40, 40]             512
    ​                SiLU-176          [-1, 256, 40, 40]               0
    ​                Conv-177          [-1, 256, 40, 40]               0
    ​              Conv2d-178          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-179          [-1, 256, 40, 40]             512
    ​                SiLU-180          [-1, 256, 40, 40]               0
    ​                Conv-181          [-1, 256, 40, 40]               0
    ​          Bottleneck-182          [-1, 256, 40, 40]               0
    ​              Conv2d-183          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-184          [-1, 256, 40, 40]             512
    ​                SiLU-185          [-1, 256, 40, 40]               0
    ​                Conv-186          [-1, 256, 40, 40]               0
    ​              Conv2d-187          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-188          [-1, 256, 40, 40]             512
    ​                SiLU-189          [-1, 256, 40, 40]               0
    ​                Conv-190          [-1, 256, 40, 40]               0
    ​          Bottleneck-191          [-1, 256, 40, 40]               0
    ​              Conv2d-192          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-193          [-1, 256, 40, 40]             512
    ​                SiLU-194          [-1, 256, 40, 40]               0
    ​                Conv-195          [-1, 256, 40, 40]               0
    ​              Conv2d-196          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-197          [-1, 256, 40, 40]             512
    ​                SiLU-198          [-1, 256, 40, 40]               0
    ​                Conv-199          [-1, 256, 40, 40]               0
    ​          Bottleneck-200          [-1, 256, 40, 40]               0
    ​              Conv2d-201          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-202          [-1, 256, 40, 40]             512
    ​                SiLU-203          [-1, 256, 40, 40]               0
    ​                Conv-204          [-1, 256, 40, 40]               0
    ​              Conv2d-205          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-206          [-1, 256, 40, 40]             512
    ​                SiLU-207          [-1, 256, 40, 40]               0
    ​                Conv-208          [-1, 256, 40, 40]               0
    ​          Bottleneck-209          [-1, 256, 40, 40]               0
    ​              Conv2d-210          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-211          [-1, 256, 40, 40]             512
    ​                SiLU-212          [-1, 256, 40, 40]               0
    ​                Conv-213          [-1, 256, 40, 40]               0
    ​              Conv2d-214          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-215          [-1, 256, 40, 40]             512
    ​                SiLU-216          [-1, 256, 40, 40]               0
    ​                Conv-217          [-1, 256, 40, 40]               0
    ​          Bottleneck-218          [-1, 256, 40, 40]               0
    ​              Conv2d-219          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-220          [-1, 256, 40, 40]             512
    ​                SiLU-221          [-1, 256, 40, 40]               0
    ​                Conv-222          [-1, 256, 40, 40]               0
    ​              Conv2d-223          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-224          [-1, 256, 40, 40]             512
    ​                SiLU-225          [-1, 256, 40, 40]               0
    ​                Conv-226          [-1, 256, 40, 40]               0
    ​          Bottleneck-227          [-1, 256, 40, 40]               0
    ​              Conv2d-228          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-229          [-1, 256, 40, 40]             512
    ​                SiLU-230          [-1, 256, 40, 40]               0
    ​                Conv-231          [-1, 256, 40, 40]               0
    ​              Conv2d-232          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-233          [-1, 256, 40, 40]             512
    ​                SiLU-234          [-1, 256, 40, 40]               0
    ​                Conv-235          [-1, 256, 40, 40]               0
    ​          Bottleneck-236          [-1, 256, 40, 40]               0
    ​              Conv2d-237          [-1, 256, 40, 40]         131,072
    ​         BatchNorm2d-238          [-1, 256, 40, 40]             512
    ​                SiLU-239          [-1, 256, 40, 40]               0
    ​                Conv-240          [-1, 256, 40, 40]               0
    ​              Conv2d-241          [-1, 512, 40, 40]         262,144
    ​         BatchNorm2d-242          [-1, 512, 40, 40]           1,024
    ​                SiLU-243          [-1, 512, 40, 40]               0
    ​                Conv-244          [-1, 512, 40, 40]               0
    ​                  C3-245          [-1, 512, 40, 40]               0
    ​              Conv2d-246         [-1, 1024, 20, 20]       4,718,592
    ​         BatchNorm2d-247         [-1, 1024, 20, 20]           2,048
    ​                SiLU-248         [-1, 1024, 20, 20]               0
    ​                Conv-249         [-1, 1024, 20, 20]               0
    ​              Conv2d-250          [-1, 512, 20, 20]         524,288
    ​         BatchNorm2d-251          [-1, 512, 20, 20]           1,024
    ​                SiLU-252          [-1, 512, 20, 20]               0
    ​                Conv-253          [-1, 512, 20, 20]               0
    ​           MaxPool2d-254          [-1, 512, 20, 20]               0
    ​           MaxPool2d-255          [-1, 512, 20, 20]               0
    ​           MaxPool2d-256          [-1, 512, 20, 20]               0
    ​              Conv2d-257         [-1, 1024, 20, 20]       2,097,152
    ​         BatchNorm2d-258         [-1, 1024, 20, 20]           2,048
    ​                SiLU-259         [-1, 1024, 20, 20]               0
    ​                Conv-260         [-1, 1024, 20, 20]               0
    ​                 SPP-261         [-1, 1024, 20, 20]               0
    ​              Conv2d-262          [-1, 512, 20, 20]         524,288
    ​         BatchNorm2d-263          [-1, 512, 20, 20]           1,024
    ​                SiLU-264          [-1, 512, 20, 20]               0
    ​                Conv-265          [-1, 512, 20, 20]               0
    ​              Conv2d-266          [-1, 512, 20, 20]         262,144
    ​         BatchNorm2d-267          [-1, 512, 20, 20]           1,024
    ​                SiLU-268          [-1, 512, 20, 20]               0
    ​                Conv-269          [-1, 512, 20, 20]               0
    ​              Conv2d-270          [-1, 512, 20, 20]       2,359,296
    ​         BatchNorm2d-271          [-1, 512, 20, 20]           1,024
    ​                SiLU-272          [-1, 512, 20, 20]               0
    ​                Conv-273          [-1, 512, 20, 20]               0
    ​          Bottleneck-274          [-1, 512, 20, 20]               0
    ​              Conv2d-275          [-1, 512, 20, 20]         262,144
    ​         BatchNorm2d-276          [-1, 512, 20, 20]           1,024
    ​                SiLU-277          [-1, 512, 20, 20]               0
    ​                Conv-278          [-1, 512, 20, 20]               0
    ​              Conv2d-279          [-1, 512, 20, 20]       2,359,296
    ​         BatchNorm2d-280          [-1, 512, 20, 20]           1,024
    ​                SiLU-281          [-1, 512, 20, 20]               0
    ​                Conv-282          [-1, 512, 20, 20]               0
    ​          Bottleneck-283          [-1, 512, 20, 20]               0
    ​              Conv2d-284          [-1, 512, 20, 20]         262,144
    ​         BatchNorm2d-285          [-1, 512, 20, 20]           1,024
    ​                SiLU-286          [-1, 512, 20, 20]               0
    ​                Conv-287          [-1, 512, 20, 20]               0
    ​              Conv2d-288          [-1, 512, 20, 20]       2,359,296
    ​         BatchNorm2d-289          [-1, 512, 20, 20]           1,024
    ​                SiLU-290          [-1, 512, 20, 20]               0
    ​                Conv-291          [-1, 512, 20, 20]               0
    ​          Bottleneck-292          [-1, 512, 20, 20]               0
    ​              Conv2d-293          [-1, 512, 20, 20]         524,288
    ​         BatchNorm2d-294          [-1, 512, 20, 20]           1,024
    ​                SiLU-295          [-1, 512, 20, 20]               0
    ​                Conv-296          [-1, 512, 20, 20]               0
    ​              Conv2d-297         [-1, 1024, 20, 20]       1,048,576
    ​         BatchNorm2d-298         [-1, 1024, 20, 20]           2,048
    ​                SiLU-299         [-1, 1024, 20, 20]               0
    ​                Conv-300         [-1, 1024, 20, 20]               0
    ​                  C3-301         [-1, 1024, 20, 20]               0
    ​          CSPDarknet-302  [[-1, 256, 80, 80], [-1, 512, 40, 40], [-1, 1024, 20, 20]]               0
    ​              Conv2d-303          [-1, 512, 20, 20]         524,288
    ​         BatchNorm2d-304          [-1, 512, 20, 20]           1,024
    ​                SiLU-305          [-1, 512, 20, 20]               0
    ​                Conv-306          [-1, 512, 20, 20]               0
    ​            Upsample-307          [-1, 512, 40, 40]               0
    ​              Conv2d-308          [-1, 256, 40, 40]         262,144
    ​         BatchNorm2d-309          [-1, 256, 40, 40]             512
    ​                SiLU-310          [-1, 256, 40, 40]               0
    ​                Conv-311          [-1, 256, 40, 40]               0
    ​              Conv2d-312          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-313          [-1, 256, 40, 40]             512
    ​                SiLU-314          [-1, 256, 40, 40]               0
    ​                Conv-315          [-1, 256, 40, 40]               0
    ​              Conv2d-316          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-317          [-1, 256, 40, 40]             512
    ​                SiLU-318          [-1, 256, 40, 40]               0
    ​                Conv-319          [-1, 256, 40, 40]               0
    ​          Bottleneck-320          [-1, 256, 40, 40]               0
    ​              Conv2d-321          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-322          [-1, 256, 40, 40]             512
    ​                SiLU-323          [-1, 256, 40, 40]               0
    ​                Conv-324          [-1, 256, 40, 40]               0
    ​              Conv2d-325          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-326          [-1, 256, 40, 40]             512
    ​                SiLU-327          [-1, 256, 40, 40]               0
    ​                Conv-328          [-1, 256, 40, 40]               0
    ​          Bottleneck-329          [-1, 256, 40, 40]               0
    ​              Conv2d-330          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-331          [-1, 256, 40, 40]             512
    ​                SiLU-332          [-1, 256, 40, 40]               0
    ​                Conv-333          [-1, 256, 40, 40]               0
    ​              Conv2d-334          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-335          [-1, 256, 40, 40]             512
    ​                SiLU-336          [-1, 256, 40, 40]               0
    ​                Conv-337          [-1, 256, 40, 40]               0
    ​          Bottleneck-338          [-1, 256, 40, 40]               0
    ​              Conv2d-339          [-1, 256, 40, 40]         262,144
    ​         BatchNorm2d-340          [-1, 256, 40, 40]             512
    ​                SiLU-341          [-1, 256, 40, 40]               0
    ​                Conv-342          [-1, 256, 40, 40]               0
    ​              Conv2d-343          [-1, 512, 40, 40]         262,144
    ​         BatchNorm2d-344          [-1, 512, 40, 40]           1,024
    ​                SiLU-345          [-1, 512, 40, 40]               0
    ​                Conv-346          [-1, 512, 40, 40]               0
    ​                  C3-347          [-1, 512, 40, 40]               0
    ​              Conv2d-348          [-1, 256, 40, 40]         131,072
    ​         BatchNorm2d-349          [-1, 256, 40, 40]             512
    ​                SiLU-350          [-1, 256, 40, 40]               0
    ​                Conv-351          [-1, 256, 40, 40]               0
    ​            Upsample-352          [-1, 256, 80, 80]               0
    ​              Conv2d-353          [-1, 128, 80, 80]          65,536
    ​         BatchNorm2d-354          [-1, 128, 80, 80]             256
    ​                SiLU-355          [-1, 128, 80, 80]               0
    ​                Conv-356          [-1, 128, 80, 80]               0
    ​              Conv2d-357          [-1, 128, 80, 80]          16,384
    ​         BatchNorm2d-358          [-1, 128, 80, 80]             256
    ​                SiLU-359          [-1, 128, 80, 80]               0
    ​                Conv-360          [-1, 128, 80, 80]               0
    ​              Conv2d-361          [-1, 128, 80, 80]         147,456
    ​         BatchNorm2d-362          [-1, 128, 80, 80]             256
    ​                SiLU-363          [-1, 128, 80, 80]               0
    ​                Conv-364          [-1, 128, 80, 80]               0
    ​          Bottleneck-365          [-1, 128, 80, 80]               0
    ​              Conv2d-366          [-1, 128, 80, 80]          16,384
    ​         BatchNorm2d-367          [-1, 128, 80, 80]             256
    ​                SiLU-368          [-1, 128, 80, 80]               0
    ​                Conv-369          [-1, 128, 80, 80]               0
    ​              Conv2d-370          [-1, 128, 80, 80]         147,456
    ​         BatchNorm2d-371          [-1, 128, 80, 80]             256
    ​                SiLU-372          [-1, 128, 80, 80]               0
    ​                Conv-373          [-1, 128, 80, 80]               0
    ​          Bottleneck-374          [-1, 128, 80, 80]               0
    ​              Conv2d-375          [-1, 128, 80, 80]          16,384
    ​         BatchNorm2d-376          [-1, 128, 80, 80]             256
    ​                SiLU-377          [-1, 128, 80, 80]               0
    ​                Conv-378          [-1, 128, 80, 80]               0
    ​              Conv2d-379          [-1, 128, 80, 80]         147,456
    ​         BatchNorm2d-380          [-1, 128, 80, 80]             256
    ​                SiLU-381          [-1, 128, 80, 80]               0
    ​                Conv-382          [-1, 128, 80, 80]               0
    ​          Bottleneck-383          [-1, 128, 80, 80]               0
    ​              Conv2d-384          [-1, 128, 80, 80]          65,536
    ​         BatchNorm2d-385          [-1, 128, 80, 80]             256
    ​                SiLU-386          [-1, 128, 80, 80]               0
    ​                Conv-387          [-1, 128, 80, 80]               0
    ​              Conv2d-388          [-1, 256, 80, 80]          65,536
    ​         BatchNorm2d-389          [-1, 256, 80, 80]             512
    ​                SiLU-390          [-1, 256, 80, 80]               0
    ​                Conv-391          [-1, 256, 80, 80]               0
    ​                  C3-392          [-1, 256, 80, 80]               0
    ​              Conv2d-393          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-394          [-1, 256, 40, 40]             512
    ​                SiLU-395          [-1, 256, 40, 40]               0
    ​                Conv-396          [-1, 256, 40, 40]               0
    ​              Conv2d-397          [-1, 256, 40, 40]         131,072
    ​         BatchNorm2d-398          [-1, 256, 40, 40]             512
    ​                SiLU-399          [-1, 256, 40, 40]               0
    ​                Conv-400          [-1, 256, 40, 40]               0
    ​              Conv2d-401          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-402          [-1, 256, 40, 40]             512
    ​                SiLU-403          [-1, 256, 40, 40]               0
    ​                Conv-404          [-1, 256, 40, 40]               0
    ​              Conv2d-405          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-406          [-1, 256, 40, 40]             512
    ​                SiLU-407          [-1, 256, 40, 40]               0
    ​                Conv-408          [-1, 256, 40, 40]               0
    ​          Bottleneck-409          [-1, 256, 40, 40]               0
    ​              Conv2d-410          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-411          [-1, 256, 40, 40]             512
    ​                SiLU-412          [-1, 256, 40, 40]               0
    ​                Conv-413          [-1, 256, 40, 40]               0
    ​              Conv2d-414          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-415          [-1, 256, 40, 40]             512
    ​                SiLU-416          [-1, 256, 40, 40]               0
    ​                Conv-417          [-1, 256, 40, 40]               0
    ​          Bottleneck-418          [-1, 256, 40, 40]               0
    ​              Conv2d-419          [-1, 256, 40, 40]          65,536
    ​         BatchNorm2d-420          [-1, 256, 40, 40]             512
    ​                SiLU-421          [-1, 256, 40, 40]               0
    ​                Conv-422          [-1, 256, 40, 40]               0
    ​              Conv2d-423          [-1, 256, 40, 40]         589,824
    ​         BatchNorm2d-424          [-1, 256, 40, 40]             512
    ​                SiLU-425          [-1, 256, 40, 40]               0
    ​                Conv-426          [-1, 256, 40, 40]               0
    ​          Bottleneck-427          [-1, 256, 40, 40]               0
    ​              Conv2d-428          [-1, 256, 40, 40]         131,072
    ​         BatchNorm2d-429          [-1, 256, 40, 40]             512
    ​                SiLU-430          [-1, 256, 40, 40]               0
    ​                Conv-431          [-1, 256, 40, 40]               0
    ​              Conv2d-432          [-1, 512, 40, 40]         262,144
    ​         BatchNorm2d-433          [-1, 512, 40, 40]           1,024
    ​                SiLU-434          [-1, 512, 40, 40]               0
    ​                Conv-435          [-1, 512, 40, 40]               0
    ​                  C3-436          [-1, 512, 40, 40]               0
    ​              Conv2d-437          [-1, 512, 20, 20]       2,359,296
    ​         BatchNorm2d-438          [-1, 512, 20, 20]           1,024
    ​                SiLU-439          [-1, 512, 20, 20]               0
    ​                Conv-440          [-1, 512, 20, 20]               0
    ​              Conv2d-441          [-1, 512, 20, 20]         524,288
    ​         BatchNorm2d-442          [-1, 512, 20, 20]           1,024
    ​                SiLU-443          [-1, 512, 20, 20]               0
    ​                Conv-444          [-1, 512, 20, 20]               0
    ​              Conv2d-445          [-1, 512, 20, 20]         262,144
    ​         BatchNorm2d-446          [-1, 512, 20, 20]           1,024
    ​                SiLU-447          [-1, 512, 20, 20]               0
    ​                Conv-448          [-1, 512, 20, 20]               0
    ​              Conv2d-449          [-1, 512, 20, 20]       2,359,296
    ​         BatchNorm2d-450          [-1, 512, 20, 20]           1,024
    ​                SiLU-451          [-1, 512, 20, 20]               0
    ​                Conv-452          [-1, 512, 20, 20]               0
    ​          Bottleneck-453          [-1, 512, 20, 20]               0
    ​              Conv2d-454          [-1, 512, 20, 20]         262,144
    ​         BatchNorm2d-455          [-1, 512, 20, 20]           1,024
    ​                SiLU-456          [-1, 512, 20, 20]               0
    ​                Conv-457          [-1, 512, 20, 20]               0
    ​              Conv2d-458          [-1, 512, 20, 20]       2,359,296
    ​         BatchNorm2d-459          [-1, 512, 20, 20]           1,024
    ​                SiLU-460          [-1, 512, 20, 20]               0
    ​                Conv-461          [-1, 512, 20, 20]               0
    ​          Bottleneck-462          [-1, 512, 20, 20]               0
    ​              Conv2d-463          [-1, 512, 20, 20]         262,144
    ​         BatchNorm2d-464          [-1, 512, 20, 20]           1,024
    ​                SiLU-465          [-1, 512, 20, 20]               0
    ​                Conv-466          [-1, 512, 20, 20]               0
    ​              Conv2d-467          [-1, 512, 20, 20]       2,359,296
    ​         BatchNorm2d-468          [-1, 512, 20, 20]           1,024
    ​                SiLU-469          [-1, 512, 20, 20]               0
    ​                Conv-470          [-1, 512, 20, 20]               0
    ​          Bottleneck-471          [-1, 512, 20, 20]               0
    ​              Conv2d-472          [-1, 512, 20, 20]         524,288
    ​         BatchNorm2d-473          [-1, 512, 20, 20]           1,024
    ​                SiLU-474          [-1, 512, 20, 20]               0
    ​                Conv-475          [-1, 512, 20, 20]               0
    ​              Conv2d-476         [-1, 1024, 20, 20]       1,048,576
    ​         BatchNorm2d-477         [-1, 1024, 20, 20]           2,048
    ​                SiLU-478         [-1, 1024, 20, 20]               0
    ​                Conv-479         [-1, 1024, 20, 20]               0
    ​                  C3-480         [-1, 1024, 20, 20]               0
    ​              Conv2d-481          [-1, 255, 80, 80]          65,535
    ​              Conv2d-482          [-1, 255, 40, 40]         130,815
    ​    
                   Conv2d-483          [-1, 255, 20, 20]         261,375
        ================================================================
    Total params: 47,056,765
    Trainable params: 47,056,765
    
    Non-trainable params: 0
    ----------------------------------------------------------------
    
    Input size (MB): 4.69
    Forward/backward pass size (MB): 2730.40
    Params size (MB): 179.51
    
    Estimated Total Size (MB): 2914.60
    ----------------------------------------------------------------
    
    torch.Size([1, 64, 320, 320])
    Total GFLOPS: 115.918G
    Total params: 47.057M


​      
​    




​    


（7月11日）

## dataset和dataloader

- dataset是用于读取、导入、划分数据集的，即，打包数据集
- dataloader是用于数据预处理，resize、suffer、数据增强等，得到可以直接导入网络的数据



## 损失函数

### 均方差损失函数

- 用于预测宽高合适，小编以为宽高是定值，主要是预测它们之间的差值，故倾向线性预测



### 交叉熵损失函数

- 中心坐标的预测，它具有那种偏移不确定性
- 预测框有无目标
- 物体的类别预测



### 预测框loss预测

- 一个好的预测，loss应该关注到重合面积，中心点的距离，长宽比，不重合面积



#### Loss_iou系列

- 1 - iou： 如果两个框没有相交，iou为0，不能反映两个框的预测，且没有梯度回传，且无法反映重合度的效果，单纯反应重合面积，不考虑形状，优点，对尺度不敏感
- 1 - Giou： 与iou相比Giou的关注点不一样，Giou不仅关注重叠区域还关注其他非重叠区域，且GIoU有对称区间，取值范围[-1,1]。在两者重合的时候取最大值1，在两者无交集且无限远的时候取最小值-1，因此GIoU是一个非常好的距离度量指标。
- ![image-20220711180220727](C:\Users\Happy\AppData\Roaming\Typora\typora-user-images\image-20220711180220727.png)-    Diou更考虑框的回归机制，中心点的距离以，重合率以及尺度都考虑进去，减少发散问题
- ![image-20220711180749734](C:\Users\Happy\AppData\Roaming\Typora\typora-user-images\image-20220711180749734.png)-  这个loss就关注到了重合率，中心距离、以及长宽比。



原up主得模型得检测指标，他是在已经训练好的权重下再训练优化的

![image-20220715154653042](C:\Users\Happy\AppData\Roaming\Typora\typora-user-images\image-20220715154653042.png)

![image-20220715154741450](C:\Users\Happy\AppData\Roaming\Typora\typora-user-images\image-20220715154741450.png)





### 本机训练一个epoch



![image-20220712161351259](C:\Users\Happy\AppData\Roaming\Typora\typora-user-images\image-20220712161351259.png)

开始的随机性很大，这个epoch的loss开始是2.7左右，训练完以后如上图所示，可以明显看到loss下降了，以为这个随机性很好，其实想多了，这里的val即test，两个一样，开始时，val_loss为7.3左右，val完以后变成7.1左右，肉眼可见的变化。不过还好，因为现在只是测试一下，也算是正常。但这是在有权值的基础之上训练的。

下面是改变epoch参数和batch_size后，再次开始训练，随机性的确很大，一下子loss就变成了4.2左右。

![image-20220712161611094](C:\Users\Happy\AppData\Roaming\Typora\typora-user-images\image-20220712161611094.png)

因为受训练时长的影响，所以我先配置服务器虚拟环境。



## training

7月13-14日

后面小编不太会lunux环境，所以就先用本机跑跑第一次时，所有的指标几乎都是0，后面慢慢显示有map，很低。回去一看，居然是数据集图片和标签对不上，改好以后，又跑一遍，发现练map都没有，但是，导入up得已经训练好的模型loss下降就很明显，而我从0开始训练的结果如下,，我不好说了。

![image-20220715103316182](C:\Users\Happy\AppData\Roaming\Typora\typora-user-images\image-20220715103316182.png)

开始寻找原因。



7月15日

​	今天过来，开始检查数据集，因为数据集有差错，可能是因为当时网络原因没有完整的下载，数据集的数目对不上，又重新加载数据集，运行生成VOC格式的数据集，并完成数据集的划分。由于我的设备可能没有原主的好，他设置的迭代参数很大，我根据我的设备和他的解释修改了epoch和batch_size，以及使用混合精度来训练，但我修改完成以后，我发现，我的batch_size为8时，我的loss几乎没有变化，这很不对劲。

​	我就开始思考，因为原主的迭代次数和batch_size是居于一定的比例设置的，然后我就更改了batch_size的大小，果然，目前的训练，loss是变化的而且是呈下降的趋势在变化。

​	我在之前的训练中也遇到过类似的，那时虽然原主的batch_siae比较大，且原主的loss下降的趋势也很平滑，但是我修改batch_size后，虽然我的loss变化的幅度大，但他整体的下降趋势比原主的好，最后得到的准确率比原主的准确率高了0.1，分类展示的效果也很好，所以我觉得是一次投入的数据集相对较多，而且epoch的数值也比较大，数据呈现的概率趋势比较整齐，且loss的更新次数也相对减少，及对网络的调整也变少了，而我batch_size相对而言是比较少的，对网络的更新和调整次数相对较多，检测效果也会稍好。所以，loss本身的值并不重要，loss平不平滑代表loss的趋势稳不稳定而已，而他所呈现的总趋势才是网络性能的体现。当然这还是要看网络结构复杂度和数据集大小的，因为过于频繁调整，网络过度敏感就不好了。故我也会用batch_size做一个小小的消融实验的。

![image-20220715201851986](C:\Users\Happy\AppData\Roaming\Typora\typora-user-images\image-20220715201851986.png)

虽然目前得到的map看起来不正常，但是，相比于第一次，她至少有数据了。



7月16日

今天de了一天的bug，查看代码。昨天出现的评测指标异常问题的原因还是数据集的问题，标签移动没有移完全，数据没加载完。不出意外，现在开始训练的应该是没有问题的，数据、标签，train、val都是对应的了。

代码能运行，评测指标异常，先查看数据集有没有问题，图片标签对应没有，数据有没有缺少等，然后再去查看代码，debug这些。



GitHub 上的网络结构示意图

[[![img](https://github.com/yuanxiao7/summer_project/raw/master/.%5Cpicture%5C8.png)](https://github.com/yuanxiao7/summer_project/blob/master/picture\8.png)](https://github.com/yuanxiao7/summer_project/commit/3cfd44dccc2e92a4887bd738cc83b5a2564d9202)f719d01d29830a4f005ad0a171c05bf5b8bffde0
